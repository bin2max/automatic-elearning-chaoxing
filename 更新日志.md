# 更新日志

## v1.4.6 (2025-08-05)
### 🔧 优化改进
- **移除无效的弹窗关闭方法**：删除了`close_face_recognition_popup`方法中的方法1（JavaScript点击关闭按钮）
  - 根据测试结果，方法1无效，移除后不会影响功能
  - 重新编号其他方法：方法2→方法1，方法3→方法2，方法4→方法3，方法5→方法4
  - 提高程序效率，更快尝试有效的方法

### 🐛 解决的问题
- 移除了无效的JavaScript点击关闭按钮方法
- 避免了无效方法的执行时间浪费
- 让程序更快地尝试有效的关闭方法

### 📝 技术细节
- 保留了4种有效的弹窗关闭方法：
  - 方法1：执行页面刷新（window.location.reload()）
  - 方法2：尝试多种关闭按钮选择器
  - 方法3：JavaScript隐藏弹窗元素
  - 方法4：导航到课程目录作为最后手段

## v1.4.5 (2025-08-04)
### 🔧 重要修复
- **修复iframe识别问题**：改进了`switch_to_video_iframe`方法，更准确地识别包含视频的iframe
  - 扩展了iframe检查条件，支持多种视频iframe识别方式
  - 增加了更全面的视频元素检查，包括HTML5 video、Video.js播放器等
  - 添加了视频元素验证，确保找到的是真正的视频元素
- **优化弹窗检查逻辑**：改进了`check_face_recognition_popup`方法，避免在视频播放时干扰视频
  - 在检查弹窗前先验证视频是否正在播放
  - 如果视频正在播放，跳过弹窗检查，避免干扰视频播放
  - 增强了弹窗可见性检查，确保元素真正可见且不是隐藏的
- **优化课程完成检测**：改进了`wait_for_course_completion`方法
  - 减少重复检查，提高检测效率
  - 使用`last_video_status`避免重复调用视频状态检查
  - 更好的状态管理和错误处理

### 🐛 解决的问题
- 修复了程序在视频播放时误判人脸识别弹窗的问题
- 解决了iframe识别不准确导致视频状态检测失败的问题
- 避免了弹窗检查操作干扰正在播放的视频

### 📝 技术细节
- 改进了iframe切换逻辑，支持多种视频播放器类型
- 增强了视频状态检测的准确性
- 优化了弹窗检测的时机和方式

## v1.4.4 (2025-08-04)
### 修复
- **修复视频播放时误判弹窗问题**：实现综合判断逻辑，避免视频播放时误判人脸识别弹窗
- **改进弹窗检测逻辑**：优先检查弹窗元素可见性，避免页面文本残留导致的误判

### 新增功能
- **综合判断逻辑**：
  - 根据视频播放状态决定是否检查弹窗
  - 视频播放中：不检查弹窗，继续等待
  - 视频完成：检查弹窗并处理
  - 视频暂停：检查弹窗并处理
  - 视频状态未知：谨慎检查弹窗
- **改进弹窗检测**：
  - 优先检查弹窗元素可见性
  - 只有在隐藏元素中找到相关文本才认为是弹窗
  - 避免页面文本残留导致的误判

### 技术细节
- 实现视频状态驱动的弹窗检测逻辑
- 改进 `check_face_recognition_popup()` 方法，增加可见性优先检查
- 支持隐藏元素中文本的检测，避免误判
- 优化日志输出，明确显示检测逻辑和结果

---

**感谢您的使用！** 🎓 